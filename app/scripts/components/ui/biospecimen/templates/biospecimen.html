<section class="row" id="biospecimen">
  <div class="col-lg-12 col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading clearfix">
        <h3 class="panel-title pull-left" data-translate>Biospecimen</h3>
        <a class="btn btn-default pull-right"
           data-ng-if="bc.bioSpecimenFileId"
           data-ng-href="{{ [bc.bioSpecimenFileId] | makeDownloadLink }}"
           data-translate>Download Biospecimen XML</a>

      </div>
      <div class="panel-body">
        <div class="col-lg-6 col-md-6">
          <h4 data-translate>Samples</h4>

          <div data-ng-repeat="sample in participant.samples">
            <!-- Apparently the samples can be missing this data -->
            <div data-ng-if="sample.submitter_id">
              <i class="fa fa-plus-square-o action" data-ng-if="!sample.expanded"
                 data-ng-click="expandTree($event, sample)"
                 data-ng-keypress="expandTree($event, sample)"
                 aria-label="Expand Sample {{ sample.submitter_id }}"></i>
              <i class="fa fa-minus-square-o action" data-ng-if="sample.expanded"
                 data-ng-click="expandTree($event, sample)"
                 data-ng-keypress="expandTree($event, sample)"
                 aria-label="Collapse Sample {{ sample.submitter_id }}"></i>
              <i class="fa fa-file-o" data-ng-if="!sample.expanded"></i>
              <i class="fa fa-file-o" data-ng-if="sample.expanded"></i>
              &nbsp;
              <span data-ng-click="bc.displayBioSpecimenDocument($event, sample, 'sample')"
                    data-ng-keypress="bc.displayBioSpecimenDocument($event, sample, 'sample')"
                    class="biospecimen-id">
                {{ sample.submitter_id }}
              </span>

              <div data-ng-if="sample.portions.length" data-ng-class="{ hidden: !sample.expanded }"
                   aria-expanded="sample.expanded">
                <div class="biospecimen-row section">
                  <i class="fa fa-plus-square-o action" data-ng-if="!sample.portions.expanded"
                     data-ng-click="expandTree($event, sample.portions)"
                     data-ng-keypress="expandTree($event, sample.portions)"
                     aria-label="Expand Portions for {{ sample.submitter_id }}"></i>
                  <i class="fa fa-minus-square-o action" data-ng-if="sample.portions.expanded"
                     data-ng-click="expandTree($event, sample.portions)"
                     data-ng-keypress="expandTree($event, sample.portions)"
                     aria-label="Collapse Portions for {{ sample.submitter_id }}"></i>
                  <i class="fa fa-folder-o" data-ng-if="!sample.portions.expanded"></i>
                  <i class="fa fa-folder-open-o" data-ng-if="sample.portions.expanded"></i>
                  &nbsp;<span class="h5" data-translate>Portions</span>

                  <div data-ng-repeat="portion in sample.portions" class="biospecimen-row"
                       data-ng-if="sample.portions.expanded">

                    <i class="fa fa-plus-square-o action" data-ng-if="!portion.expanded"
                       data-ng-click="expandTree($event, portion)"
                       data-ng-keypress="expandTree($event, portion)"
                       aria-label="Expand Portion {{ portion.submitter_id }}"></i>
                    <i class="fa fa-minus-square-o action" data-ng-if="portion.expanded"
                       data-ng-click="expandTree($event, portion)"
                       data-ng-keypress="expandTree($event, portion)"
                       aria-label="Collapse Portion {{ portion.submitter_id }}"></i>
                    <i class="fa fa-file-o" data-ng-if="!portion.expanded"></i>
                    <i class="fa fa-file-o" data-ng-if="portion.expanded"></i>
                    &nbsp;
                    <span data-ng-click="bc.displayBioSpecimenDocument($event, portion, 'portion')"
                          data-ng-keypress="bc.displayBioSpecimenDocument($event, portion, 'portion')"
                          class="biospecimen-id">
                      {{ portion.submitter_id }}
                    </span>

                    <div data-ng-if="portion.slides.length" data-ng-class="{ hidden: !portion.expanded }"
                         aria-expanded="portion.expanded">
                      <div class="biospecimen-row section">
                        <i class="fa fa-plus-square-o action" data-ng-if="!portion.slides.expanded"
                           data-ng-click="expandTree($event, portion.slides)"
                           data-ng-keypress="expandTree($event, portion.slides)"
                           aria-label="Expand Slides for {{ portion.submitter_id }}"></i>
                        <i class="fa fa-minus-square-o action" data-ng-if="portion.slides.expanded"
                           data-ng-click="expandTree($event, portion.slides)"
                           data-ng-keypress="expandTree($event, portion.slides)"
                           aria-label="Collapse Slides for {{ portion.submitter_id }}"></i>
                        <i class="fa fa-folder-o" data-ng-if="!portion.slides.expanded"></i>
                        <i class="fa fa-folder-open-o" data-ng-if="portion.slides.expanded"></i>
                        &nbsp;
                        <span class="h5" data-translate>Slides</span>

                        <div data-ng-repeat="slide in portion.slides" class="biospecimen-row document"
                             data-ng-click="bc.displayBioSpecimenDocument($event, slide, 'slide')"
                             data-ng-keypress="bc.displayBioSpecimenDocument($event, slide, 'slide')"
                             data-ng-if="portion.slides.expanded">
                          <i class="fa fa-file-o"></i>
                          &nbsp;{{ slide.submitter_id }}
                        </div>
                      </div>
                    </div>

                    <div data-ng-if="portion.analytes.length" data-ng-class="{ hidden: !portion.expanded }"
                         aria-expanded="portion.expanded">
                      <div class="biospecimen-row section">
                        <i class="fa fa-plus-square-o action" data-ng-if="!portion.analytes.expanded"
                           data-ng-click="expandTree($event, portion.analytes)"
                           data-ng-keypress="expandTree($event, portion.analytes)"
                           aria-label="Expand Portions for {{ sample.submitter_id }}"></i>
                        <i class="fa fa-minus-square-o action" data-ng-if="portion.analytes.expanded"
                           data-ng-click="expandTree($event, portion.analytes)"
                           data-ng-keypress="expandTree($event, portion.analytes)"
                           aria-label="Collapse Portions for {{ sample.submitter_id }}"></i>
                        <i class="fa fa-folder-o" data-ng-if="!portion.analytes.expanded"></i>
                        <i class="fa fa-folder-open-o" data-ng-if="portion.analytes.expanded"></i>
                        &nbsp;
                        <span class="h5" data-translate>Analytes</span>

                        <div data-ng-repeat="analyte in portion.analytes" class="biospecimen-row"
                             data-ng-if="portion.analytes.expanded">
                          <i class="fa fa-plus-square-o" data-ng-if="!analyte.expanded"
                             data-ng-click="expandTree($event, analyte)"
                             data-ng-keypress="expandTree($event, analyte)"
                             aria-label="Expand Analytes {{ portion.submitter_id }}"></i>
                          <i class="fa fa-minus-square-o" data-ng-if="analyte.expanded"
                             data-ng-click="expandTree($event, analyte)"
                             data-ng-keypress="expandTree($event, analyte)"
                             aria-label="Collapse Analytes {{ portion.submitter_id }}"></i>
                          <i class="fa fa-folder-o" data-ng-if="!analyte.expanded"></i>
                          <i class="fa fa-folder-open-o" data-ng-if="analyte.expanded"></i>
                          &nbsp;
                          <span data-ng-click="bc.displayBioSpecimenDocument($event, analyte, 'analyte')"
                                data-ng-keypress="bc.displayBioSpecimenDocument($event, analyte, 'analyte')"
                                data-ng-if="portion.analytes.expanded"
                                class="biospecimen-id">
                            {{ analyte.submitter_id }}
                          </span>

                          <div data-ng-if="analyte.aliquots.length" data-ng-class="{ hidden: !analyte.expanded }"
                               aria-expanded="analyte.expanded">
                            <div class="biospecimen-row section">
                              <i class="fa fa-plus-square-o action" data-ng-if="!analyte.aliquots.expanded"
                                 data-ng-click="expandTree($event, analyte.aliquots)"
                                 data-ng-keypress="expandTree($event, analyte.aliquots)"
                                 aria-label="Expand Aliquots for {{ analyte.submitter_id }}"></i>
                              <i class="fa fa-minus-square-o action" data-ng-if="analyte.aliquots.expanded"
                                 data-ng-click="expandTree($event, analyte.aliquots)"
                                 data-ng-keypress="expandTree($event, analyte.aliquots)"
                                 aria-label="Collapse Aliquots for {{ analyte.submitter_id }}"></i>
                              <i class="fa fa-folder-o" data-ng-if="!analyte.aliquots.expanded"></i>
                              <i class="fa fa-folder-open-o" data-ng-if="analyte.aliquots.expanded"></i>
                              &nbsp;
                              <span class="h5" data-translate>Aliquots</span>

                              <div data-ng-repeat="aliquot in analyte.aliquots" class="biospecimen-row document"
                                   data-ng-click="bc.displayBioSpecimenDocument($event, aliquot, 'aliquot')"
                                   data-ng-keypress="bc.displayBioSpecimenDocument($event, aliquot, 'aliquot')"
                                   data-ng-if="analyte.aliquots.expanded">
                                <i class="fa fa-file-o"></i>
                                &nbsp;{{ aliquot.submitter_id }}
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-6" data-ng-class="{ hidden: !bc.activeBioSpecimenDocument }">
          <h4 data-translate>Details</h4>
          <table id="biospecimen-table" class="table table-striped table-hover table-condensed table-bordered">
            <tbody>
            <tr data-ng-repeat="(key, value) in bc.activeBioSpecimenDocument"
                data-ng-if="bc.displayBioSpecimenDocumentRow(key, value)">
              <th scope="row" data-translate>{{ key | humanify }}</th>
              <td>{{ bc.displayBioSpecimenDocumentRowValue(key, value) }}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</section>
