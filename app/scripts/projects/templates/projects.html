<div class="container-fluid projects search">
  <h1 data-translate>Projects</h1>

  <search-bar></search-bar>

  <div class="row search-panel">
    <div class="col-lg-2 col-md-3 facets-sidebar" data-ng-show="!prsc.$scope.advancedQuery">
      <facets-free-text placeholder="{{ '(Project Name or Code)' | translate }}" field="project_code"></facets-free-text>
      <facet-terms data-facet="prsc.projects.aggregations.diseaseType"></facet-terms>
      <terms data-name="project_code"
             data-facet="prsc.projects.aggregations.project_code" data-title="Project Code"></terms>
      <terms data-name="program"
             data-facet="prsc.projects.aggregations.program" data-title="Program"></terms>
      <terms data-name="status"
             data-facet="prsc.projects.aggregations.status" data-title="Status"></terms>
      <facet-terms data-facet="prsc.projects.facets.dataType"></facet-terms>
      <facet-terms data-facet="prsc.projects.facets.experimentalStrategy"></facet-terms>
    </div>
    <h2 class="col-lg-10 col-md-9" data-ng-if="!prsc.projects">
      <i class="fa fa-spinner fa-spin"></i> Loading projects...
    </h2>

    <h2 class="col-lg-10 col-md-9" data-ng-if="prsc.projects.hits.length === 0">
      No projects found using those filters.
    </h2>

    <div class="col-lg-10 col-md-9" data-ng-if="prsc.projects.hits.length > 0"
         data-ng-class="{ 'col-lg-10 col-md-9': !prsc.$scope.advancedQuery, 'col-lg-12 col-md-12': prsc.$scope.advancedQuery }">
      <h4 class="clearfix">
        <span class="pull-right">
          <select-columns></select-columns>
          <export-table></export-table>
        </span>
      </h4>

      <table class="table table-striped table-hover table-condensed table-bordered">
        <thead>
        <tr>
          <th scope="col" rowspan="2" class="text-center" data-translate>Code</th>
          <th scope="col" rowspan="2" class="text-center" data-translate>Name</th>
          <th scope="col" rowspan="2" class="text-center" data-translate>Program</th>
          <th scope="col" rowspan="2" class="text-center">
            &#35; <span data-translate>Participants</span>
          </th>
          <th scope="col" colspan="6" rowspan="1" class="text-center" data-translate>
            Available Data Files per Data Type
          </th>
          <th scope="col" rowspan="2" class="text-center" data-translate>Status</th>
          <th scope="col" rowspan="2" class="text-center" data-translate>Last Update</th>
        </tr>
        <tr>
          <th scope="col" data-translate>Clinical</th>
          <th scope="col" data-translate>SNV</th>
          <th scope="col" data-translate>mRNA</th>
          <th scope="col" data-translate>miRNA</th>
          <th scope="col" data-translate>Copy Number</th>
          <th scope="col" data-translate>Meth</th>
        </tr>
        </thead>
        <tbody>
        <tr data-ng-repeat="p in prsc.projects.hits track by p.project_code">
          <td><a data-ui-sref="project({ projectId: p.project_code })">{{ ::p.project_code }}</a></td>
          <td>{{ ::p.project_name }}</td>
          <td>{{ ::p.program }}</td>
          <td>
            <a data-ui-sref="search.participants({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              }
            ])})">
              {{ ::p._summary._participant_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'Clinical data'
              }
            ])})">
              {{ ::p._summary._analyzed_data["Clinical data"].file_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'SNV'
              }
            ])})">
              {{ ::p._summary._analyzed_data["SNV"].file_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'mRNA Expression'
              }
            ])})">
              ??? {{ ::p._summary._analyzed_data["mRNA Expression"].file_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'miRNA Expression'
              }
            ])})">
              ??? {{ ::p._summary._analyzed_data["miRNA Expression"].file_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'CNV'
              }
            ])})">
              {{ ::p._summary._analyzed_data["CNV"].file_count }}
            </a>
          </td>
          <td>
            <a data-ui-sref="search.files({ 'filters': makeFilter([
              {
                name: 'project_code', value: p.project_code
              },
              {
                name: 'data_type', value: 'DNA methylation'
              }
            ])})">
              ??? {{ ::p._summary._analyzed_data["DNA methylation"].file_count }}
            </a>
          </td>
          <td>{{ ::p.status}}</td>
          <td>{{ ::p.date | date }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="pagination-controls">
    <div class="number-results pull-left">
      <span data-translate>Show</span>

      <div class="btn-group dropup" dropdown is-open="status.isopen">
        <button type="button" class="btn btn-default dropdown-toggle" data-ng-disabled="disabled">
          {{ sc.files.pagination.count }} <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" role="menu">
          <li data-ng-click="prsc.searchQuery($event, 10)"
              data-ng-keypress="prsc.searchQuery($event, 10)"
              role="button"
              aria-label="Data Sample Size">10</li>
          <li data-ng-click="prsc.searchQuery($event, 20)"
              data-ng-keypress="prsc.searchQuery($event, 20)"
              role="button"
              aria-label="Data Sample Size">20</li>
          <li data-ng-click="prsc.searchQuery($event, 40)"
              data-ng-keypress="prsc.searchQuery($event, 40)"
              role="button"
              aria-label="Data Sample Size">40</li>
          <li data-ng-click="prsc.searchQuery($event, 60)"
              data-ng-keypress="prsc.searchQuery($event, 60)"
              role="button"
              aria-label="Data Sample Size">60</li>
          <li data-ng-click="prsc.searchQuery($event, 80)"
              data-ng-keypress="prsc.searchQuery($event, 80)"
              role="button"
              aria-label="Data Sample Size">80</li>
          <li data-ng-click="prsc.searchQuery($event, 100)"
              data-ng-keypress="prsc.searchQuery($event, 100)"
              role="button"
              aria-label="Data Sample Size">100</li>
        </ul>
      </div>
      <span data-translate>entries</span>
    </div>
    <pagination boundary-links="true"
                total-items="prsc.projects.pagination.total"
                data-ng-model="prsc.projects.pagination.page"
                items-per-page="prsc.projects.pagination.count"
                class="pagination-sm pull-right"
                data-ng-change="prsc.searchQuery()"
                num-pages="prsc.projects.pagination.pages"
                max-size="6"
                rotate="false"
                previous-text="&lsaquo;"
                next-text="&rsaquo;"
                first-text="&laquo;"
                last-text="&raquo;"></pagination>
  </div>
</div>
